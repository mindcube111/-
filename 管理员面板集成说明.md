# 管理员面板集成说明

## ✅ 已完成的功能

### 1. 管理员入口（右上角）
- 在 `index.html` 右上角添加了管理员入口按钮（⚙️ 图标）
- 点击按钮可以打开/关闭管理员面板

### 2. 管理员面板
- 弹窗式设计，与网站风格一致
- 包含登录表单和管理功能区域
- 响应式设计，支持移动端

### 3. 自动同步到 KV
- 生成邀请码时自动调用 `/api/add-invite` API
- 邀请码自动添加到 Cloudflare KV 存储
- **无需手动导入 KV**

### 4. 功能列表
- ✅ 管理员登录（调用 `/api/admin-login`）
- ✅ 生成单个邀请码
- ✅ 批量生成邀请码（1-100个）
- ✅ 自动复制生成的邀请码到剪贴板
- ✅ 统计信息显示（占位，实际需要维护计数器）

## 📁 新增文件

1. **`css/admin-panel.css`** - 管理员面板样式
2. **`js/admin-panel.js`** - 管理员面板逻辑
3. **`functions/api/add-invite.js`** - 添加邀请码到 KV 的 API 端点

## 🔧 API 端点

### POST `/api/add-invite`
添加邀请码到 KV 存储

**请求头：**
```
Authorization: Bearer <管理员密码>
Content-Type: application/json
```

**请求体：**
```json
{
  "codes": ["ABC123", "DEF456", ...]
}
```

**响应：**
```json
{
  "ok": true,
  "total": 2,
  "success": 2,
  "failed": 0,
  "results": [
    { "code": "ABC123", "ok": true },
    { "code": "DEF456", "ok": true }
  ]
}
```

## 🎯 使用流程

1. **打开管理员面板**
   - 点击页面右上角的 ⚙️ 按钮

2. **登录**
   - 输入管理员密码（与 Cloudflare 环境变量 `ADMIN_PASSWORD` 一致）
   - 点击"登录"按钮

3. **生成邀请码**
   - **单个生成**：点击"生成单个"按钮
   - **批量生成**：输入数量（1-100），点击"批量生成"按钮
   - 生成的邀请码会自动：
     - 添加到 Cloudflare KV
     - 显示在面板中
     - 复制到剪贴板

4. **退出登录**
   - 点击"退出登录"按钮

## ⚠️ 注意事项

1. **管理员密码**
   - 必须与 Cloudflare Pages 环境变量 `ADMIN_PASSWORD` 一致
   - 在 Cloudflare Dashboard 中配置

2. **KV 存储**
   - 邀请码使用哈希存储（SHA-256 + SALT）
   - 需要配置 `INVITE_SALT` 环境变量
   - 需要绑定 `INVITE_CODES` KV 命名空间

3. **统计信息**
   - 当前显示占位数据（`-`）
   - 由于 KV 不支持列出所有键，无法直接统计
   - 如需统计功能，可以：
     - 维护一个计数器键在 KV 中
     - 或使用其他存储方案

4. **安全性**
   - API 使用 Bearer Token 认证
   - 管理员密码作为 Token
   - 建议在生产环境中设置速率限制

## 🔄 与原有系统的关系

- **管理员后台** (`admin.html`)：保留，用于本地开发
- **管理员面板**：新增，集成在主页面，用于生产环境
- **邀请码验证**：已连接 API，验证 KV 中的邀请码

## 📝 后续优化建议

1. **统计功能**
   - 在 KV 中维护计数器键
   - 每次添加/使用邀请码时更新计数器

2. **邀请码管理**
   - 查看已生成的邀请码列表
   - 删除/禁用邀请码

3. **批量操作**
   - 导出邀请码列表
   - 导入邀请码（从文件）

4. **日志记录**
   - 记录邀请码生成和使用日志

---

**最后更新**：2025-01-XX

