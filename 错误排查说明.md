# 错误排查说明

## 🔍 错误分析

你看到的错误：
```
Failed to load resource: net::ERR_CONNECTION_CLOSED
Immersive Translate ERROR: run cron task failed TypeError: Failed to fetch
```

### 错误来源
这个错误来自浏览器扩展 **Immersive Translate**（沉浸式翻译），不是项目代码的问题。

### 原因
- 浏览器扩展尝试访问某些资源时连接失败
- 与你的项目代码无关

---

## ✅ 解决方案

### 方法 1：禁用或更新扩展（推荐）
1. 打开浏览器扩展管理页面
2. 找到 "Immersive Translate" 扩展
3. 暂时禁用或更新到最新版本

### 方法 2：忽略扩展错误
- 这个错误不影响你的网站功能
- 可以忽略，专注于项目相关的错误

---

## 🔍 检查项目相关错误

### 1. 打开浏览器开发者工具（F12）

### 2. 查看 Console 标签
- 查找项目相关的错误（不是扩展错误）
- 查找以下关键词：
  - `invite-code`
  - `admin-panel`
  - `api/verify-invite`
  - `api/add-invite`

### 3. 查看 Network 标签
- 检查 API 请求是否成功
- 查看 `/api/verify-invite` 的响应
- 查看 `/api/add-invite` 的响应

---

## 🎯 项目相关的错误检查

### 如果看到以下错误，需要关注：

1. **API 请求失败**
   ```
   POST /api/verify-invite net::ERR_...
   ```
   - 检查网络连接
   - 检查 Cloudflare Pages 部署状态

2. **CORS 错误**
   ```
   Access to fetch at '...' from origin '...' has been blocked by CORS policy
   ```
   - 检查 API 端点配置

3. **404 错误**
   ```
   GET /api/... 404 (Not Found)
   ```
   - 检查 Functions 文件路径
   - 检查部署是否成功

4. **500 错误**
   ```
   POST /api/... 500 (Internal Server Error)
   ```
   - 检查环境变量配置
   - 检查 KV 绑定

---

## 📋 正常情况下的日志

### 成功验证邀请码时，应该看到：
```
API 验证响应: {
  status: 200,
  ok: true,
  data: { ok: true, usedCount: 1, remaining: 2 }
}
```

### 失败时，应该看到：
```
API 验证响应: {
  status: 404,
  ok: false,
  data: { ok: false, message: "invalid", debug: {...} }
}
```

---

## 🛠️ 如果项目有错误

### 1. 检查部署状态
- Cloudflare Dashboard → Deployments
- 确认最新部署成功

### 2. 检查环境变量
- Settings → Environment variables
- 确认 `ADMIN_PASSWORD` 和 `INVITE_SALT` 已配置

### 3. 检查 KV 绑定
- Settings → KV namespaces
- 确认 `INVITE_CODES` 已绑定

### 4. 测试 API
使用 curl 或浏览器直接测试：
```bash
curl -X POST https://你的域名/api/verify-invite \
  -H "Content-Type: application/json" \
  -d '{"code":"TEST01"}'
```

---

## ✅ 总结

- ✅ **Immersive Translate 错误**：可以忽略，不影响项目
- ⚠️ **项目错误**：需要关注并修复
- 🔍 **检查方法**：查看 Console 和 Network 标签，过滤掉扩展错误

---

**提示**：如果只看到扩展错误，说明项目代码没有问题。专注于项目相关的错误信息。

